import{u as O,r as i,h as S,c as h,a as t,d as M,e as P,f as R,b as c,w as V,v as z,n as L,F as A,i as E,t as f,o as _,R as F}from"./index-BjQqRrCT.js";import{a as r,S as I}from"./sweetalert2.all-DNnFSqmk.js";const K={id:"todoListPage",class:"bg-half"},U={class:"mb-48px"},j=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),q={class:"todo_sm"},G={class:"container todoListPage vhContainer"},H={class:"todoList_Content"},J={class:"inputBox"},Q=t("i",{class:"fa fa-plus"},null,-1),W=[Q],X={key:0,class:"todoList_list"},Y={class:"todoList_tab"},Z={class:"todoList_items"},tt={class:"todoList_item"},et={class:"todoList_label"},st=["checked","onClick"],ot=["onClick"],at=t("i",{class:"fa fa-times"},null,-1),lt=[at],nt={class:"todoList_statistics"},it={key:1},ct=t("p",{class:"todoList__empty-title"},"目前尚無待辦事項",-1),rt=t("img",{class:"todoList__empty-img",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/empty%201.png",alt:"empty-img"},null,-1),ut=[ct,rt],u="https://todolist-api.hexschool.io",vt={__name:"TodoListView",setup(dt){const m=O(),w=T(),d={headers:{Authorization:w}},x=i(""),v=i(""),l=i([]),o=i("all"),p=i(0),n=i([]);function y({type:s,text:e}){I.fire({title:"訊息",text:e,icon:s,confirmButtonText:"關閉"})}function T(){return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)todoListToken\\s*=\\s*([^;]*).*$)|^.*$"),"$1")}const $=async()=>{try{const s=await r.get(`${u}/users/checkout`,d);x.value=s.data.nickname}catch{y({type:"error",text:"登入驗證失效"}),m.push("/")}},C=async()=>{try{const s=await r.post(`${u}/users/sign_out`,{},{headers:{Authorization:w}});y({type:"success",text:s.data.message}),m.push("/")}catch{y({type:"error",text:"登出失敗"}),m.push("/")}},b=async()=>{try{await r.post(`${u}/todos/`,{content:v.value},d),v.value="",k(o.value)}catch(s){console.log(s)}};async function k(s="all"){try{const e=await r.get(`${u}/todos/`,d);l.value=[...e.data.data],g(s)}catch(e){console.log(e)}}const D=async s=>{try{await r.patch(`${u}/todos/${s}/toggle`,{},d),k(o.value)}catch(e){console.log(e)}},B=async s=>{try{await r.delete(`${u}/todos/${s}`,d),k(o.value)}catch(e){console.log(e)}},g=s=>{switch(o.value=s,o.value){case"checked":n.value=l.value.filter(e=>e.status),p.value=n.value.length;break;case"unchecked":n.value=l.value.filter(e=>!e.status),p.value=n.value.length;break;case"all":default:n.value=[...l.value],p.value=l.value.filter(e=>!e.status).length;break}};return S(()=>{$(),k(o.value)}),(s,e)=>(_(),h("div",K,[t("nav",U,[j,t("ul",null,[t("li",q,[M(R(F),{to:"/todoList",class:"formControls_btnLink"},{default:P(()=>[t("span",null,f(x.value)+"的代辦",1)]),_:1})]),t("li",null,[t("a",{href:"#loginPage",onClick:c(C,["prevent"])},"登出")])])]),t("div",G,[t("div",H,[t("div",J,[V(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a)},null,512),[[z,v.value]]),t("a",{href:"#",onClick:c(b,["prevent"])},W)]),l.value.length?(_(),h("div",X,[t("ul",Y,[t("li",null,[t("a",{href:"#",class:L(o.value==="all"?"active":""),onClick:e[1]||(e[1]=c(a=>g("all"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:L(o.value==="unchecked"?"active":""),onClick:e[2]||(e[2]=c(a=>g("unchecked"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:L(o.value==="checked"?"active":""),onClick:e[3]||(e[3]=c(a=>g("checked"),["prevent"]))},"已完成",2)])]),t("div",Z,[t("ul",tt,[(_(!0),h(A,null,E(n.value,a=>(_(),h("li",{key:a.id},[t("label",et,[t("input",{class:"todoList_input",type:"checkbox",checked:a.status,onClick:N=>D(a.id)},null,8,st),t("span",null,f(a.content),1)]),t("a",{href:"#",onClick:c(N=>B(a.id),["prevent"])},lt,8,ot)]))),128))]),t("div",nt,[t("p",null,f(p.value)+" 個"+f(o.value==="checked"?"已":"待")+"完成項目",1)])])])):(_(),h("div",it,ut))])])]))}};export{vt as default};
