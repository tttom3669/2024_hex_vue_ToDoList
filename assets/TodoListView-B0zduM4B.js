import{u as S,r as c,h as M,c as _,a as t,d as P,e as R,f as a,b as r,w as V,v as z,n as w,F as A,i as E,t as g,o as p,R as F}from"./index-BquTWH03.js";import{a as u,S as I}from"./sweetalert2.all-DNnFSqmk.js";const K={id:"todoListPage",class:"bg-half"},U=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),j={class:"todo_sm"},q={class:"container todoListPage vhContainer"},G={class:"todoList_Content"},H={class:"inputBox"},J=t("i",{class:"fa fa-plus"},null,-1),Q=[J],W={class:"todoList_list"},X={class:"todoList_tab"},Y={class:"todoList_items"},Z={key:0,class:"todoList_item"},tt={class:"todoList_label"},et=["checked","onClick"],st=["onClick"],ot=t("i",{class:"fa fa-times"},null,-1),at=[ot],nt={key:1,class:"todoList_empty"},lt={class:"todoList_statistics"},d="https://todolist-api.hexschool.io",ut={__name:"TodoListView",setup(it){const y=S(),T=x(),h={headers:{Authorization:T}},$=c(""),m=c("");let n=c([]),l=c(""),v=c(0),i=c([]);function L({type:s,text:e}){I.fire({title:"訊息",text:e,icon:s,confirmButtonText:"關閉"})}function x(){return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)todoListToken\\s*=\\s*([^;]*).*$)|^.*$"),"$1")}const C=async()=>{try{const s=await u.get(`${d}/users/checkout`,h);$.value=s.data.nickname}catch{L({type:"error",text:"登入驗證失效"}),y.push("/")}},D=async()=>{try{const s=await u.post(`${d}/users/sign_out`,{},{headers:{Authorization:T}});L({type:"success",text:s.data.message}),y.push("/")}catch{L({type:"error",text:"登出失敗"}),y.push("/")}},b=async()=>{try{await u.post(`${d}/todos/`,{content:m.value},h),k()}catch(s){console.log(s)}};async function k(s="all"){try{const e=await u.get(`${d}/todos/`,h);n.value=[...e.data.data],f(s)}catch(e){console.log(e)}}const B=async s=>{try{await u.patch(`${d}/todos/${s}/toggle`,{},h),k()}catch(e){console.log(e)}},N=async s=>{try{await u.delete(`${d}/todos/${s}`,h),k()}catch(e){console.log(e)}},f=s=>{switch(l.value=s,l.value){case"checked":i.value=n.value.filter(e=>e.status),v.value=i.value.length;break;case"unchecked":i.value=n.value.filter(e=>!e.status),v.value=i.value.length;break;case"all":default:i.value=[...n.value],v.value=n.value.filter(e=>!e.status).length;break}};return M(()=>{C(),k()}),(s,e)=>(p(),_("div",K,[t("nav",null,[U,t("ul",null,[t("li",j,[P(a(F),{to:"/todoList",class:"formControls_btnLink"},{default:R(()=>[t("span",null,g($.value)+"的代辦",1)]),_:1})]),t("li",null,[t("a",{href:"#loginPage",onClick:r(D,["prevent"])},"登出")])])]),t("div",q,[t("div",G,[t("div",H,[V(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o)},null,512),[[z,m.value]]),t("a",{href:"#",onClick:r(b,["prevent"])},Q)]),t("div",W,[t("ul",X,[t("li",null,[t("a",{href:"#",class:w(a(l)==="all"?"active":""),onClick:e[1]||(e[1]=r(o=>f("all"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:w(a(l)==="unchecked"?"active":""),onClick:e[2]||(e[2]=r(o=>f("unchecked"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:w(a(l)==="checked"?"active":""),onClick:e[3]||(e[3]=r(o=>f("checked"),["prevent"]))},"已完成",2)])]),t("div",Y,[a(n).length?(p(),_("ul",Z,[(p(!0),_(A,null,E(a(i),o=>(p(),_("li",{key:o.id},[t("label",tt,[t("input",{class:"todoList_input",type:"checkbox",checked:o.status,onClick:O=>B(o.id)},null,8,et),t("span",null,g(o.content),1)]),t("a",{href:"#",onClick:r(O=>N(o.id),["prevent"])},at,8,st)]))),128))])):(p(),_("p",nt,"目前尚無待辦事項")),t("div",lt,[t("p",null,g(a(v))+" 個"+g(a(l)==="checked"?"已":"待")+"完成項目",1)])])])])])]))}};export{ut as default};
